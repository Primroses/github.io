<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>æƒ³æ— ç¼è¿æ¥ Vue3.0ï¼Œå…ˆä½“éªŒä¸€ä¸‹ composition-api</title><link rel="icon" type="image/png" href=https://primroses.github.io/myBlogimg/icon.ico />
	<link rel="shortcut icon" href=/icon.ico><meta name="description" content = "composition-apiç›®æ ‡å°±æ˜¯å°† 2.x ä¸­ä¸é€»è¾‘ç›¸å…³çš„é€‰é¡¹éƒ½ä»¥å‡½æ•°å½¢å¼æŠ½ç¦»å‡ºæ¥"/>
	
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" media="screen" href="https://primroses.github.io/myBlog/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://primroses.github.io/myBlog/css/main.css" /><script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script><script src="https://primroses.github.io/myBlog/js/main.js"></script>
	<script src="https://primroses.github.io/myBlog/js/background.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title">Front-end habitat</h1>
	<div class="site-description "><div class="subtitle">Record My growth experiences</div><nav class="nav social">
			<ul class="flat"><a href="https://github.com/Primroses" title="Github"><i data-feather="github"></i></a><a href="https://github.com/Primroses" title="heart"><i data-feather="hexagon"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/myBlog/">ä¸»é¡µ</a>
			</li>
			
			<li>
				<a href="/myBlog/fundamention">åŸºç¡€</a>
			</li>
			
			<li>
				<a href="/myBlog/framework">æ¡†æ¶</a>
			</li>
			
			<li>
				<a href="/myBlog/project">å·¥ç¨‹åŒ–</a>
			</li>
			
			<li>
				<a href="/myBlog/about">å…³äº</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h2 class="title">æƒ³æ— ç¼è¿æ¥ Vue3.0ï¼Œå…ˆä½“éªŒä¸€ä¸‹ composition-api</h2>
			<div class="meta">Posted at &mdash; Apr 7, 2020</div>
		</div>

		<div class="markdown">
			

<p>é˜…è¯»æœ¬æ–‡ä½ å¯ä»¥äº†è§£åˆ°</p>

<ol>
<li>æå‰æ„Ÿå—ä¸€ä¸‹ Vue3.x(ä»¥ composition-api ä¸ºä¾‹)</li>
<li>composition-api è§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>
<li>composition-api é…åˆ TypeScript çš„ä½¿ç”¨</li>
<li>å¯¹ Composition-api ç†è§£çš„æœ€ä½³å®è·µ</li>
</ol>

<h2 id="vue3-x-çš„æ”¹åŠ¨-ä»‹ç»ä¸€äº›æ¯”è¾ƒå¸¸è§çš„">Vue3.x çš„æ”¹åŠ¨(ä»‹ç»ä¸€äº›æ¯”è¾ƒå¸¸è§çš„)</h2>

<blockquote>
<p>Vue3.0 çš„ RFC æå‡ºæ¥ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ã€‚ä»åˆšå¼€å§‹çš„ function-base-api åˆ°ç°åœ¨çš„ composition-apiã€‚è¿™ä¸¤è€…éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡å°±æ˜¯å°† 2.x ä¸­ä¸é€»è¾‘ç›¸å…³çš„é€‰é¡¹éƒ½ä»¥å‡½æ•°å½¢å¼æŠ½ç¦»å‡ºæ¥</p>
</blockquote>

<ol>
<li>ref å’Œ reactive</li>
</ol>

<p>è¿™ä¸¤ä¸ªéƒ½èƒ½å®šä¹‰å“åº”å¼æ•°æ®ï¼Œåœ¨è¿™é‡Œå…¶å®æœ‰é‚£ä¹ˆç‚¹åŒºåˆ«ï¼Œå…ˆä¸¾ä¸ªä¾‹å­</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#00f">const</span> x = ref&lt;number&gt;(0)
<span style="color:#00f">const</span> y = ref&lt;string&gt;(<span style="color:#a31515">&#34;Hello World&#34;</span>)
<span style="color:#008000">// x yçš„ç±»å‹æ˜¯ Ref&lt;number&gt; | Ref&lt;string&gt;
</span><span style="color:#008000"></span>
<span style="color:#00f">const</span> state = reactive({
    text:<span style="color:#a31515">&#34;Hello World&#34;</span>
})
</code></pre></div>
<p>è¿™é‡Œçš„ Ref ç±»å‹æ˜¯åŒ…è£…ç±»å‹çš„æ„æ€ã€‚ä»¥å‰çš„ Vue2.x ç›´æ¥ç›‘å¬çš„æ˜¯å­—ç¬¦ä¸²ï¼Œè¿˜æœ‰æ•°å­—çš„å˜åŒ–ã€‚å› ä¸ºè¿™äº›å€¼éƒ½æ˜¯ä½œä¸º data çš„å±æ€§å€¼å­˜åœ¨ï¼Œç›‘å¬çš„å…¶å®æ˜¯ data å¯¹è±¡çš„å±æ€§å€¼ã€‚ä½†æ˜¯ç°åœ¨å•ç‹¬åœ¨å‡½æ•°ä¸­è¿”å›çš„å­—ç¬¦ä¸²ï¼Œå’Œæ•°å­—ç­‰åŸºæœ¬æ•°å­—ç±»å‹ï¼Œä¸å­˜åœ¨å¼•ç”¨å…³ç³»ï¼Œæ˜¯æ— æ³•è¿½è¸ªåŸå§‹å˜é‡åç»­çš„å˜åŒ–çš„ã€‚æ‰€ä»¥åŒ…è£…å¯¹è±¡çš„æ„ä¹‰å°±åœ¨äºæä¾›ä¸€ä¸ªè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å‡½æ•°ä¹‹é—´ä»¥å¼•ç”¨çš„æ–¹å¼ä¼ é€’ä»»æ„ç±»å‹å€¼çš„å®¹å™¨ã€‚å®¹å™¨çš„å­˜åœ¨å¯ä»¥é€šè¿‡å¼•ç”¨çš„æ–¹å¼ä¼ å›ç»™ç»„ä»¶ã€‚</p>

<p>state è·ŸåŸæ¥çš„ Vue2.x çš„å°±å¾ˆå¾ˆç±»ä¼¼ï¼Œå­˜åœ¨äº state å¯¹è±¡ä¸Šï¼Œç›‘å¬çš„æ˜¯ state å±æ€§çš„å˜åŒ–ã€‚</p>

<p>æ€ä¹ˆå»é€‰æ‹©å®šä¹‰æ•°æ®çš„æ–¹æ³•?å…¶å®å¾ˆç®€å•ï¼Œéƒ½å¯ä»¥ï¼Œçœ‹ä¸ªäººä¹ æƒ¯é—®é¢˜ã€‚</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#00f">const</span> state = reactive({
    user:{
        name:<span style="color:#a31515">&#34;A&#34;</span>,
        age:10,
        where:<span style="color:#a31515">&#34;china&#34;</span>
    }
})
<span style="color:#008000">// ç›¸å½“äº
</span><span style="color:#008000"></span><span style="color:#00f">const</span> state = {
    name :<span style="color:#a31515">&#34;A&#34;</span>,
    age:10,
    where:<span style="color:#a31515">&#34;china&#34;</span>
}
<span style="color:#00f">const</span> userName = ref&lt;string&gt;(<span style="color:#a31515">&#34;A&#34;</span>)
<span style="color:#00f">const</span> userAge = ref&lt;number&gt;(10)
<span style="color:#00f">const</span> userWhere = ref&lt;string&gt;(<span style="color:#a31515">&#34;china&#34;</span>)
<span style="color:#008000">// ç›¸å½“äº
</span><span style="color:#008000"></span><span style="color:#00f">const</span> name = <span style="color:#a31515">&#34;A&#34;</span>;
<span style="color:#00f">const</span> age = 10;
<span style="color:#00f">const</span> where = <span style="color:#a31515">&#39;china&#39;</span>
</code></pre></div>
<p>âš ï¸ æ³¨æ„åœ¨ä½¿ç”¨ Ref çš„æ—¶å€™ï¼Œåœ¨æ¨¡æ¿ä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œä½†æ˜¯åœ¨å‡½æ•°é‡Œé¢ï¼Œä¼ é€’çš„æ˜¯å¯¹è±¡ã€‚æ‰€ä»¥è¦å–å€¼çš„æ—¶å€™è®°å¾—è¦åŠ  ref.value æ‰èƒ½å–å€¼</p>

<p>2.watch</p>

<p>watch ç”¨è¿‡çš„åŒå­¦éƒ½çŸ¥é“æ˜¯ç”¨æ¥è§‚å¯Ÿæ•°æ®å˜åŒ–è¿›è¡Œå¯¹åº”çš„æ“ä½œçš„ã€‚è¿™æ¬¡çš„æ”¹åŠ¨æ˜¯å°†åŸæ¥çš„ Options çš„å†™æ³•æ¢æˆå‡½æ•°çš„å½¢å¼è¿›è¡Œè°ƒç”¨ã€‚</p>

<p>watch çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯è¿”å›ä»»æ„å€¼çš„å‡½æ•°ï¼Œä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼Œè¿˜æœ‰æ˜¯åŒ…å«ä¸¤ç§æ•°æ®çš„æ•°ç»„</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript">...
<span style="color:#00f">const</span> state = reactive&lt;{count:number}&gt;({
    count:1,
})
watch(
  () =&gt; state.count,
  (cur,pre) =&gt; {
      <span style="color:#008000">// è§‚å¯Ÿçš„æ˜¯ stateå¯¹è±¡é‡Œé¢çš„ä¸€ä¸ªå€¼åœ¨è¿™é‡Œè¿›è¡Œæ“ä½œ
</span><span style="color:#008000"></span>  },
);
...
...
<span style="color:#00f">const</span> name = ref&lt;string&gt;(<span style="color:#a31515">&#34;Hello World&#34;</span>)
watch(
  () =&gt; name,
  (cur,pre) =&gt; {
      <span style="color:#008000">// do other things
</span><span style="color:#008000"></span>  },
);
...
</code></pre></div>
<p>âš ï¸ æ³¨æ„çš„æ˜¯åŒ…è£…å¯¹è±¡ä¸èƒ½ç”¨å‡½æ•°è¿”å›ï¼Œå› ä¸ºæ˜¯ä¸¤ç§ä¸åŒç±»å‹çš„è§‚å¯Ÿå€¼ï¼Œæ‰€å¯¹åº”çš„æ“ä½œä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœç”¨å‡½æ•°è¿”å›ï¼Œåˆ™æ²¡æœ‰ç›‘å¬çš„æ•ˆæœã€‚(è™½ç„¶ä½ çœ‹åˆ°çš„å€¼æ˜¯æ”¹å˜äº†ï¼Œä½†æ˜¯ä½ .value è¿‡åä»ç„¶æ˜¯åˆå§‹çš„å€¼)</p>

<p>âš ï¸ æ³¨æ„ watch çš„å›è°ƒä¼šåœ¨åˆ›å»ºçš„æ—¶å€™å°±ä½¿ç”¨ï¼Œç±»ä¼¼äº 2.x è®¾ç½®äº†<code>immediate: true</code>,watch çš„è§¦å‘æ€»æ˜¯ä¼šåœ¨ DOM æ›´æ–°å®Œçš„æƒ…å†µä¸‹ã€‚æ‰€ä»¥è¯´å¦‚æœæƒ³è¦åœ¨ DOM æ›´æ–°å‰å°±å¾—è®¾ç½®<code>flush</code>é€‰é¡¹</p>

<p>âœï¸ watch è¿˜èƒ½å¤Ÿåœæ­¢ç›‘å¬ï¼Œè¿™æ˜¯ 2.x æ²¡æœ‰çš„</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#00f">const</span> stop = watch(()=&gt;state.count)

<span style="color:#008000">// watchå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª åœæ­¢è§‚å¯Ÿæ•°æ®çš„å‡½æ•°ã€‚ è°ƒç”¨ä¸€ä¸‹å°±èƒ½åœæ­¢è§‚å¯Ÿäº†
</span></code></pre></div>
<p>â¤ï¸ ç‰¹åˆ«è¯´æ˜ä¸€ä¸‹:å¦‚æœ watch å®åœ¨<code>setup</code>æˆ–è€…æ˜¯ç”Ÿå‘½å‘¨æœŸå‡½æ•°é‡Œé¢è°ƒç”¨ã€‚<code>watch</code>ä¼šåœ¨é”€æ¯ç»„ä»¶çš„æ—¶å€™è‡ªåŠ¨åœæ­¢</p>

<p>3.setup å‡½æ•°å’Œç”Ÿå‘½å‘¨æœŸ</p>

<p>Vue3.x çš„ç”Ÿå‘½å‘¨æœŸå‘ç”Ÿäº†äº›å˜åŒ–ï¼ŒåºŸå¼ƒäº†åŸæ¥çš„<code>created</code>å’Œ<code>beforeCreated</code>çš„ç”Ÿå‘½å‘¨æœŸ,åœ¨è¿™ä¸¤è€…ä¹‹é—´æ–°å¢äº†ä¸€ä¸ªç»„ä»¶é€‰é¡¹<code>setup</code>å‡½æ•°ã€‚</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#008000">// setupæ˜¯åœ¨åˆå§‹åŒ–propsåé¢è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä¼šæ¥å—propsä¸ºå‚æ•°ã€‚contextæ˜¯æ•´ä¸ªç»„ä»¶çš„ä¸Šä¸‹æ–‡ã€‚ä»¥å‰éƒ½æ˜¯ç”¨thisç±»æŒ‡å‘Vueç»„ä»¶ï¼Œç°åœ¨æ¢æˆå‡½æ•°å°±ç”¨å‚æ•°çš„å½¢å¼ä¼ é€’ä¸Šä¸‹æ–‡ã€‚
</span><span style="color:#008000"></span>...
setup(props:Props,context:SetupContext){
    onMounted()

    onUpdate();

    onUnMounted();
}
...
</code></pre></div>
<p>ç”Ÿå‘½å‘¨æœŸéƒ½æ”¹äº†åå­—ã€‚å¹¶ä¸”ä»¥å‡½æ•° Api çš„å½¢å¼ï¼Œæ›´é‡è¦çš„æ˜¯åªèƒ½åœ¨ setup å‡½æ•°é‡Œé¢è°ƒç”¨~ï¼</p>

<p>âš ï¸ æ³¨æ„çš„ props ä¸èƒ½è¿›è¡Œç»“æ„èµ‹å€¼ï¼Œä¹Ÿä¸èƒ½è¿›è¡Œæ‰©å±•è¿ç®—ç¬¦ç­‰ç ´åç›‘å¬å€¼çš„æ“ä½œã€‚å› ä¸ºè¿™äº›æ“ä½œéƒ½ä¼šæœ‰ä¸­é—´é‡çš„ç”Ÿæˆå¯¼è‡´ç ´ååŸæœ‰å­˜åœ¨çš„ç›‘å¬ç³»ç»Ÿã€‚è¦ç”¨çš„è¯å°±å¾—åœ¨<code>state</code>ä¸Šé¢ä½¿ç”¨<code>toRefs</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©å¯¹è±¡ä¸ä¼šç ´ååŸæ¥çš„ç›‘å¬ã€‚åŒæ—¶ Props ä¹Ÿæ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚</p>

<h2 id="composition-api-æ¯”è¾ƒ-2-x-è§£å†³äº†ä»€ä¹ˆç—›ç‚¹">Composition-api æ¯”è¾ƒ 2.x è§£å†³äº†ä»€ä¹ˆç—›ç‚¹</h2>

<h3 id="ç»„ä»¶é—´çš„é€»è¾‘å¤ç”¨">ç»„ä»¶é—´çš„é€»è¾‘å¤ç”¨</h3>

<p>åœ¨ç”¨ Composition-api çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç”¨åŸæ¥åŸºäºé€‰é¡¹çš„ options çš„åšæ³•ã€‚composition-api æ˜¯ä¸ºäº†è§£å†³ä¸€äº› 2.x å­˜åœ¨çš„é—®é¢˜ã€‚</p>

<p>vue åœ¨åº”å¯¹ç®€å•çš„ä¸šåŠ¡çš„æ—¶å€™ç¡®å®å¾ˆæ¸¸åˆƒæœ‰ä½™ã€‚ä½†æ˜¯åœ¨å¤§å‹é¡¹ç›®ï¼Œæ¶‰åŠå¾ˆå¤šç»„ä»¶ï¼Œæˆ–è€…æ˜¯ç»„ä»¶ä¹‹é—´çš„é€»è¾‘å¤ç”¨çš„é—®é¢˜çš„æ—¶å€™ï¼Œå¯èƒ½å°±æœ‰ç‚¹æ£˜æ‰‹äº†ã€‚
åœ¨è¿™ä¹‹å‰å¯èƒ½éƒ½çŸ¥é“æœ‰ Mixins,HOC ç­‰è§£å†³é€»è¾‘å¤ç”¨çš„æ‰‹æ®µã€‚ä½†æ˜¯ä»–ä»¬éƒ½æˆ–å¤šæˆ–å°‘æœ‰ç‚¹é—®é¢˜ã€‚è­¬å¦‚:æ¥æºä¸æ¸…ã€‚å‘½åç©ºé—´å†²çªã€‚éœ€è¦é¢å¤–çš„å¼€é”€ç­‰ç­‰ã€‚</p>

<p><strong>composition-api å¯ä»¥å°†ç»„ä»¶çš„é€»è¾‘å°è£…åˆ°ä¸€ä¸ªå‡½æ•°é‡Œé¢è¿›è¡Œå¤ç”¨ã€‚</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#008000">// ä¸¾ä¸€ä¸ªå°è£…çš„ä¾‹å­ åˆ¤æ–­æ˜¯å¦ä¸‹æ‹‰åˆ°åº•
</span><span style="color:#008000"></span>
<span style="color:#008000">// useIsEnd.ts
</span><span style="color:#008000"></span>...
<span style="color:#00f">const</span> isEnd = ref&lt;<span style="color:#00f">boolean</span>&gt;(<span style="color:#00f">false</span>) <span style="color:#008000">// åˆå§‹åŒ–æœªåˆ°æœ€åº•ä¸‹
</span><span style="color:#008000"></span>
<span style="color:#00f">export</span> <span style="color:#00f">function</span> getEnd(node:Ref&lt;HTMLElement&gt;){
    <span style="color:#008000">// å·²ç»å°è£…å¥½çš„ä¸‰ä¸ªå‡½æ•° åˆ¤æ–­æ˜¯å¦åˆ°åº•çš„ -10 æ˜¯ä¸ºäº†æœ‰äº›æƒ…å†µä¸‹ä¼šå‡ºç°å°æ•°(åœ¨ç§»åŠ¨ç«¯å†…åµŒçš„æ—¶å€™)
</span><span style="color:#008000"></span>    <span style="color:#00f">if</span> (
      getClientHeight(node) + (getScrollTop(node) as number) &gt;=
      getScrollHeight(node) - 10
    ) {
      isEnd.value = <span style="color:#00f">true</span>;
    } <span style="color:#00f">else</span> {
      isEnd.value = <span style="color:#00f">false</span>;
    }
    <span style="color:#00f">return</span> {
      isEnd
    }
}
<span style="color:#008000">// è¿™é‡Œå°†isEndæ”¾åœ¨å¤–é¢æ˜¯ä¸ºäº†åœ¨è§¦å‘è§¦æ‘¸äº‹ä»¶çš„æ—¶å€™(touch)ï¼Œä¸ä¼šæ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å¯¼è‡´åˆ¤æ–­å¤±è¯¯
</span><span style="color:#008000"></span>

<span style="color:#008000">// demo.vue
</span><span style="color:#008000"></span>...
<span style="color:#00f">import</span> { getEnd } from <span style="color:#a31515">&#34;useIsEnd&#34;</span>;
<span style="color:#00f">export</span> <span style="color:#00f">default</span> defineComponent({
    ...
    setup(){
        <span style="color:#00f">const</span> node = ref&lt;HTMLElement&gt;(<span style="color:#a31515">&#39;node&#39;</span>) <span style="color:#008000">// è·å–ä¸€ä¸ªnode
</span><span style="color:#008000"></span>        ...
        <span style="color:#008000">// è¿™æ˜¯@touchmove äº‹ä»¶
</span><span style="color:#008000"></span>        <span style="color:#00f">function</span> handleGetIsEnd(){
            <span style="color:#00f">const</span> { isEnd } = getEnd(node) <span style="color:#008000">// åˆ¤æ–­å½“å‰æ˜¯å¦åˆ°åº•
</span><span style="color:#008000"></span>            <span style="color:#008000">// do other things like ajax
</span><span style="color:#008000"></span>        }
        ...
        <span style="color:#00f">return</span> {
            <span style="color:#008000">// è®°å¾—return
</span><span style="color:#008000"></span>            node,
            handleGetIsEnd
        }
    }
    ...
})

...
</code></pre></div>
<p>âœï¸ ä¸å­˜åœ¨æ¥æºä¸æ¸…æ™°ï¼Œè¿”å›å€¼è¿˜å¯ä»¥é‡æ–°å®šä¹‰ï¼Œæ²¡æœ‰å‘½åç©ºé—´çš„å†²çªã€‚æŠŠæ‰€æœ‰çš„é€»è¾‘å°è£…æˆä¸€ä¸ªå‡½æ•°æ²¡æœ‰é¢å¤–çš„ç»„ä»¶çš„å¼€é”€ã€‚è¿˜æœ‰å¯ä»¥æ›´å¥½çš„ç»„ç»‡ä»£ç </p>

<h3 id="æ›´å¥½çš„ç±»å‹æ¨å¯¼">æ›´å¥½çš„ç±»å‹æ¨å¯¼</h3>

<blockquote>
<p>Vue3.x ç”¨ TypeScript é‡å†™ä¹‹åï¼Œå¯¹çš„ç±»å‹æ¨å¯¼å¤©ç„¶æ”¯æŒã€‚å†åŠ ä¸Šæ˜¯å‡½æ•°çš„ APi çš„ç¼˜æ•…ï¼Œç±»å‹æ¨å¯¼æ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p>
</blockquote>

<h3 id="æ›´åŠ å°çš„å°ºå¯¸">æ›´åŠ å°çš„å°ºå¯¸</h3>

<blockquote>
<p>ä¹Ÿæ˜¯å› ä¸ºå‡½æ•°çš„åŸå› ã€‚å¯¹ tree shakeing å‹å¥½ã€‚æ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥å•ç‹¬å¼•å…¥ï¼Œå¹¶ä¸”ä¹Ÿå› ä¸ºå‡½æ•°çš„ API çš„åŸå› å¯ä»¥å‹ç¼©å‡½æ•°åå­—è¾¾åˆ°æè‡´çš„æœ€å°å°ºå¯¸</p>
</blockquote>

<h2 id="typescript-é…åˆ-composition-api">TypeScript é…åˆ Composition-api</h2>

<blockquote>
<p>ä»¥å‰ Vue é¡¹ç›®å‡å¦‚è¦ç”¨ TypeScriptï¼Œå°±å¾—å¼•å…¥å¯¹åº”çš„æ’ä»¶(ä¾‹å¦‚ vue-class-component or vue-property-decorator)ã€‚ä½†æ˜¯é€šè¿‡ TypeScript é‡å†™ä»¥åï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ TypeScriptã€‚</p>
</blockquote>

<p>ç”¨ TypeScript ä¹Ÿæ˜¯æƒ³è¦ TypeScript çš„ç±»å‹æ¨å¯¼ï¼Œè¿™é‡Œä¸å¤šèµ˜è¿° TypeScript çš„æ¦‚å¿µ</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#008000">// è¿™é‡Œçš„interfaceå¯ä»¥è®©Tsæä¾›æç¤º
</span><span style="color:#008000"></span><span style="color:#00f">interface</span> Props{
    name:string;
    age:number;
}

<span style="color:#00f">interface</span> State{
    title:string;
    head:string;
}
...
<span style="color:#008000">// ç±»å‹æ¨å¯¼éœ€è¦ç”¨defineCompoent or createComponent
</span><span style="color:#008000"></span><span style="color:#00f">export</span> <span style="color:#00f">default</span> defineComponent({
...
    props:{
        name:String;
        age:Number;
    }
    ...
    setup(props:Props,context:SetupContext){
        ...
        <span style="color:#00f">const</span> value = ref&lt;string&gt;(<span style="color:#a31515">&#34;&#34;</span>); <span style="color:#008000">// ref çš„ç±»å‹æ˜¯Ref&lt;T&gt;
</span><span style="color:#008000"></span>        ...
        <span style="color:#00f">const</span> state = reactive&lt;State&gt;({
            title:<span style="color:#a31515">&#34;&#34;</span>,
            head:<span style="color:#a31515">&#34;&#34;</span>
        })
        ...
        <span style="color:#00f">const</span> { demo } = useXXX(...)
        demo();
        ...
        onMounted(<span style="color:#00f">async</span> ()=&gt;{
            <span style="color:#00f">const</span> res = <span style="color:#00f">await</span> fetchData(...);
            state.XXX = res.data.XXX
        })
        ...
        <span style="color:#00f">return</span> {
            value,
            <span style="color:#008000">// è¿™æ ·çš„è¯ å°±å¯ä»¥ç›´æ¥ ä½¿ç”¨ title / head
</span><span style="color:#008000"></span>            ...toRefs(state)
        }
    }
...
})
</code></pre></div>
<h2 id="typescript-å’Œ-composition-api-æœ€ä½³å®è·µ">TypeScript å’Œ Composition-api æœ€ä½³å®è·µ</h2>

<p>åœ¨ä½¿ç”¨ Composition-api çš„æ—¶å€™æˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬ç”¨çš„ç›®çš„æ˜¯ä»€ä¹ˆã€‚å½“æˆ‘ä»¬çš„é€»è¾‘å¾ˆå¤æ‚çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å®ƒæ¥å¸®æˆ‘ä»¬æŠ½ç¦»é€»è¾‘å¤ç”¨ã€‚å½“æˆ‘ä»¬æƒ³æ›´å¥½çš„ç»„ç»‡ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒè®©æˆ‘ä»¬çš„ä»£ç æ›´æœ‰æ¡ç†æ€§ã€‚</p>

<p>ğŸ’ª å®è·µ 1: å°† data(state)çŠ¶æ€è·Ÿæ–¹æ³•æŠ½ç¦»åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JavaScript" data-lang="JavaScript"><span style="color:#008000">// ä»¥å‰å¯èƒ½æ˜¯ä¼šè¿™æ ·å†™
</span><span style="color:#008000"></span><span style="color:#00f">export</span> <span style="color:#00f">default</span> {
    ...
    data(){
        <span style="color:#008000">// å½“æ•°æ®å¾ˆå¤§çš„æ—¶å€™ è¿™é‡Œå¯èƒ½ä¼šå¾ˆé•¿ å¯¹åº”çš„æ¯ä¸€æ¡ä¹Ÿéœ€è¦å†™é•¿é•¿çš„æ³¨é‡Š
</span><span style="color:#008000"></span>        <span style="color:#00f">return</span> {
            ...
            key1:value1,
            ...
        }
    }
    ...
    methods:{
      <span style="color:#008000">// æ–¹æ³•è¿™é‡Œ å¯èƒ½ä¼šè¿™æ ·å†™, å‡å¦‚æ–¹æ³•è¿‡å¤š ä¹Ÿä¼šå‡ºç°å¾ˆå†—ä½™çš„æƒ…å†µï¼Œæ³¨é‡Šè™½ç„¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾ˆå¿«çš„æ‰¾åˆ°å¯¹åº”çš„ä»£ç ã€‚ä½†æ˜¯ å¯èƒ½ä¼šå‡ºç°å‡ ç™¾è¡Œçš„æƒ…å†µ
</span><span style="color:#008000"></span>      handleXXX(){
        ... <span style="color:#00f">do</span> otherthings
      }
    }
}
</code></pre></div>
<p>ğŸ‘ ç°åœ¨æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™(ä¸€ä¸ªå‡½æ•°åŒ…è£¹è¯¥å‡½æ•°çš„è‡ªèº«çš„çŠ¶æ€ï¼Œä»…ä»…ç»´æŠ¤æœ¬å‡½æ•°è‡ªèº«çŠ¶æ€)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-TypeScript" data-lang="TypeScript"><span style="color:#008000">// index.ts
</span><span style="color:#008000"></span><span style="color:#00f">interface</span> InitState{
    key1:<span style="color:#2b91af">string</span>;
    key2:<span style="color:#2b91af">number</span>;
    key3:{
        <span style="color:#a31515">&#39;key3-1&#39;</span>:<span style="color:#2b91af">string</span>;
        <span style="color:#a31515">&#39;key3-2&#39;</span>:<span style="color:#00f">boolean</span>;
    }
}
<span style="color:#00f">export</span> <span style="color:#00f">function</span> init(){
    ...
    <span style="color:#00f">const</span> initState = reactive&lt;InitState&gt;({
      key1:<span style="color:#a31515">&#34;&#34;</span>;
      key2:<span style="color:#2b91af">0</span>;
      key3:{
          <span style="color:#a31515">&#39;key3-1&#39;</span>:<span style="color:#a31515">&#34;&#34;</span>;
          <span style="color:#a31515">&#39;key3-2&#39;</span>:<span style="color:#00f">false</span>;
      }
    })
    <span style="color:#008000">// è¿™é‡Œä¹Ÿå¯ä»¥ä¸watch ç›´æ¥ å¤–éƒ¨ async æˆ–è€…æ˜¯ promiseçš„thenç»§ç»­æ‰§è¡Œåç»­æ“ä½œä¹Ÿè¡Œ
</span><span style="color:#008000"></span>    <span style="color:#00f">const</span> stop = watch(async ()=&gt;{
        <span style="color:#00f">const</span> res = await initData(params);
        <span style="color:#00f">const</span> { key1,key2,key3 } = res.data;
        state.key1 = key1;
        state.key2 = key2;
        state.key3 = key3;
    })
    stop(); <span style="color:#008000">// å‡å¦‚ä¸æ”¾åœ¨setup é‡Œé¢çš„ æˆ–è€…æ˜¯ç”Ÿå‘½å‘¨æœŸçš„ ä¸ä¼šè‡ªåŠ¨å›æ”¶
</span><span style="color:#008000"></span>    ...
    <span style="color:#00f">return</span> {
      <span style="color:#008000">// è®°å¾—åŠ ä¸ŠtoRefså°±ä¸ä¼šä¸¢å¤±å“åº”å¼äº†
</span><span style="color:#008000"></span>      ...toRefs(initState)
    }
}

<span style="color:#008000">// index.vue
</span><span style="color:#008000"></span>template
...
&lt;script lang=<span style="color:#a31515">&#34;ts&#34;</span>&gt;
<span style="color:#00f">import</span> { defineComponent, reactive, SetupContext, toRefs } from <span style="color:#a31515">&#39;@vue/composition-api&#39;</span>;
<span style="color:#00f">import</span> { init } from <span style="color:#a31515">&#34;./index&#34;</span>

<span style="color:#00f">export</span> <span style="color:#00f">default</span> defineComponent({
  ...
  <span style="color:#008000">// åœ¨æŸäº›æƒ…å†µä¸‹ context å¯ä»¥è¿›è¡Œè§£æ„ æ‹¿å‡ºä½ æƒ³è¦çš„ æˆ–è€…åªæ˜¯ä¸€ä¸ªuiç»„ä»¶æ²¡æœ‰é€»è¾‘å¯ä»¥ä¸ä¼ 
</span><span style="color:#008000"></span>  <span style="color:#008000">/** å¸¸è§çš„è§£æ„çš„ç±»å‹
</span><span style="color:#008000">   *  {{ root }: { root: ComponentInstance }
</span><span style="color:#008000">   *  { root: { $router } }: { root: { $router: VueRouter } }
</span><span style="color:#008000">   *  { root: { $store } }: { root: { store: Store } }
</span><span style="color:#008000">   */</span>
  setup(props:<span style="color:#2b91af">Props</span>,context:<span style="color:#2b91af">SetupContext</span>){
    <span style="color:#00f">const</span> initState = init();
    <span style="color:#00f">return</span> {
      <span style="color:#008000">// è¿™é‡Œæ˜¯ä¸ºäº†æ›´æ–¹ä¾¿çš„å–å€¼
</span><span style="color:#008000"></span>      ...toRefs(initState)
    }
  }
  ...
})
&lt;script&gt;
...
style</code></pre></div>
<p>âœï¸ è¿™é‡Œåªæœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ä»…ä»…æ˜¯åˆå§‹åŒ–çš„æ—¶å€™çš„ stateã€‚è¿™é‡Œå¯ä»¥è§£æ„èµ‹å€¼ï¼Œä½†æ˜¯æˆ‘ä¸ªäººè®¤ä¸º ç›´æ¥ç”¨ä¸€ä¸ªå¯¹è±¡åŒ…è£¹ä¹‹åï¼Œå‡å°‘ä¸å¿…è¦çš„å‘½åå†²çªé—®é¢˜ã€‚è¿™é‡Œè¡¨ç¤ºçš„æ˜¯ init çš„æ—¶å€™çš„ state,åé¢å¯èƒ½ä¼šè¿˜æœ‰åˆ«çš„ stateã€‚</p>

<p>ğŸ’ª å®è·µ 2: åˆ«çš„è¯·æ±‚çš„æƒ…å†µ(value å€¼ä¸ä¼šé©¬ä¸Šæ‹¿åˆ°çš„æƒ…å†µ)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-TypeScript" data-lang="TypeScript"><span style="color:#008000">// index.ts
</span><span style="color:#008000">// è¿™é‡Œçš„valueä¸èƒ½ç›´æ¥æ‹¿åˆ°ï¼Œéœ€è¦ç­‰å¾…çš„è¯ éƒ½éœ€è¦ç”¨watch ç­‰å¾…æ”¹å˜ä¹‹åå†è¿›è¡Œè¯·æ±‚
</span><span style="color:#008000"></span>...
<span style="color:#00f">function</span> getSomeData(value) {
  <span style="color:#00f">const</span> xxxState = reactive&lt;XXXState&gt;({
    key1:<span style="color:#a31515">&#39;&#39;</span>
  })
  <span style="color:#00f">const</span> stop = watch(
    () =&gt; value,
    async (cur, pre) =&gt; {
      <span style="color:#00f">const</span> res = await fetchData(cur);
      xxxState.key1 = res.data
    },
  );
  <span style="color:#008000">// è¿™é‡Œçš„å‡å¦‚valueå€¼ä¼šå˜çš„ ä¸ä¼šåªç”¨ä¸€æ¬¡çš„ï¼Œåç»­å¯èƒ½ä¼šå˜åŒ–çš„ å°±ä¸éœ€è¦ stopäº†
</span><span style="color:#008000"></span>  <span style="color:#00f">return</span> {
    ...toRefs(xxxState)
  }
}
...</code></pre></div>
<p>ğŸ’ª å®è·µ 3: åˆå§‹åŒ–åæˆ–è€…å…¶ä»–æ–¹æ³•åˆå§‹åŒ–çš„ state åç»­åˆ«çš„æ–¹æ³•ç”¨åˆ°ï¼Œè¯¥å¦‚ä½•ä¿®æ”¹</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-TypeScript" data-lang="TypeScript"><span style="color:#008000">// index.ts
</span><span style="color:#008000"></span><span style="color:#008000">/**
</span><span style="color:#008000"> * è¿™é‡Œå¯èƒ½æœ‰ä¸‰ç§æ–¹æ³•ã€‚ç¬¬ä¸€å°†åˆå§‹åŒ–çš„stateæ”¾åˆ°å…¨å±€ä¸Š
</span><span style="color:#008000"> * å°±å¥½åƒæ“ä½œå…¨å±€çš„å˜é‡ä¸€æ ·æ“ä½œå…¨å±€çš„stateï¼Œè¿™æ ·çš„åšæ³•æ˜¯ç®€å•ï¼Œè¿™æ ·åšçš„åæœå°±æ˜¯åé¢éœ€è¦æŸ¥
</span><span style="color:#008000"> * ç°çš„é—®é¢˜çš„æ—¶å€™å°±ä¸çŸ¥é“å“ªäº›å‡½æ•°æœ‰æ“ä½œå¯¹åº”çš„stateï¼Œå¯¼è‡´éš¾ä»¥å®šä½é—®é¢˜ã€‚
</span><span style="color:#008000"> */</span>
<span style="color:#00f">const</span> initState = reactive({
  key1:<span style="color:#2b91af">1</span>;
})
async <span style="color:#00f">function</span> init(){
  <span style="color:#00f">const</span> { key1 } = await fetchData();
  initState.key1 = key1;
}
<span style="color:#008000">// è¿™ä¸ªæ–¹æ³•æˆ‘æƒ³æ”¹å˜åˆå§‹åŒ–çš„state
</span><span style="color:#008000"></span><span style="color:#00f">function</span> handleChangeInitState(){
  <span style="color:#00f">const</span> { key1 } = await fetchData();
  initState.key1 = key1;
}</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-TypeScript" data-lang="TypeScript"><span style="color:#008000">// index.ts
</span><span style="color:#008000"></span><span style="color:#008000">/**
</span><span style="color:#008000"> * ç¬¬äºŒç§ å°†åˆå§‹åŒ–çš„stateè¿”å›åï¼Œéœ€è¦ä¿®æ”¹çš„å°†stateä½œä¸ºå‚æ•°è¿›è¡Œä¼ å…¥ä¿®æ”¹
</span><span style="color:#008000"> * è¿™æ ·åšæ¯”ç¬¬ä¸€ç§å¥½ä¸€ç‚¹ã€‚çŸ¥é“æ˜¯å“ªäº›å‡½æ•°ä¿®æ”¹ï¼Œå°±ç›´æ¥çœ‹å¯¹åº”çš„å‡½æ•°å°±è¡Œï¼Œä½†æ˜¯å‡å¦‚åç»­æœ‰å¾ˆå¤šéœ€è¦ä¿®æ”¹çš„æƒ…å†µï¼Œå°±å¾—ä¼ å¾ˆå¤šæ¬¡å‚æ•°é€ æˆå†—ä½™ã€‚
</span><span style="color:#008000"> */</span>
async <span style="color:#00f">function</span> init(){
  <span style="color:#00f">const</span> initState = reactive({
    key1:<span style="color:#2b91af">1</span>;
  })
  <span style="color:#00f">const</span> { key1 } = await fetchData();
  initState.key1 = key1;
  <span style="color:#00f">return</span> {
    initState,
  }
}

<span style="color:#00f">function</span> handleChangeInitState(initState){
  <span style="color:#00f">const</span> { key1 } = await fetchData();
  initState.key1 = key1;
}</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-TypeScript" data-lang="TypeScript"><span style="color:#008000">// index.ts
</span><span style="color:#008000"></span><span style="color:#008000">/**
</span><span style="color:#008000"> * æœ€åä¸€ç§ å€Ÿé‰´react-hookçš„æ€æƒ³ï¼Œå¯¹å¤–æš´éœ²æ“ä½œæ”¹stateä¸­æŸä¸ªå±æ€§çš„æ–¹æ³•
</span><span style="color:#008000"> * æ¯”è¾ƒç®€æ´ï¼Œæ²¡æœ‰å¤šä½™çš„å‚æ•°ä¼ é€’
</span><span style="color:#008000"> */</span>
async <span style="color:#00f">function</span> init(){
  <span style="color:#00f">const</span> initState = reactive({
    key1:<span style="color:#2b91af">1</span>;
  })
  <span style="color:#00f">const</span> { key1 } = await fetchData();
  initState.key1 = key1;

  <span style="color:#00f">function</span> changeKey1(value){
    initState.key1 = value;
  }

  <span style="color:#00f">return</span> {
    changeKey1,
    ...toRefs(initState),
  }
}

<span style="color:#008000">// index.vue
</span><span style="color:#008000"></span><span style="color:#00f">import</span> { init } from <span style="color:#a31515">&#34;./index&#34;</span>
...
setup(props,context){
  <span style="color:#00f">const</span> {changeKey1,initState} = init();
  ...
  <span style="color:#008000">// è¿™é‡Œå¯ä»¥åšæ“ä½œstateçš„æ–¹æ³•
</span><span style="color:#008000"></span>  <span style="color:#00f">const</span> { xxxState } = useXXX();
  changeKey1(xxxState.key1)
  ...
  <span style="color:#00f">return</span> {
    ...toRefs(initState)
  }
}
...</code></pre></div>
<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>è¿™æ˜¯ä¸ªäººè§‰å¾— composition-api çš„æœ€ä½³å®è·µã€‚ç»„åˆå‡½æ•°å°±æ˜¯èƒ½æ›´å¥½çš„ç»„ç»‡ä»£ç ï¼Œå°†å¤šå±‚åµŒå¥—æŠ½ç¦»å‡ºæ¥åˆ†æˆä¸€ä¸ªä¸ªç»„åˆå‡½æ•°ï¼Œå°†å…¶ç»„åˆä¹‹åï¼Œå°±èƒ½è®©ä»£ç æ›´åŠ æœ‰æ¡ç†äº†ã€‚</p>

<h3 id="å‚è€ƒ">å‚è€ƒ</h3>

<ol>
<li><a href="https://composition-api.vuejs.org/api.html">Vue Composition API(RPC)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/81012971">æ¢ç§˜ Vue3.0 - Composition API åœ¨çœŸå®ä¸šåŠ¡ä¸­çš„å°é²œå§¿åŠ¿</a></li>
</ol>

		</div>

</div>
	<div class="footer wrapper">
	<nav class="nav">
		
		<div>Powered by <a href="https://gohugo.io/" target="blank">Hugo</a> | Theme -<a href="https://github.com/vividvilla/ezhil" target="blank"> Ezhil</a></div>
	</nav>
</div>
</body>
</html>
